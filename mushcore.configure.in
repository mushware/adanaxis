dnl Process this file with autoconf to produce a configure script.
AC_PREREQ(2.52)
AC_INIT(README)
AC_CANONICAL_HOST
AC_CANONICAL_TARGET

MUSHCORE_MAJOR_VERSION=0
MUSHCORE_MINOR_VERSION=0
MUSHCORE_MICRO_VERSION=1
MUSHCORE_VERSION=$MUSHCORE_MAJOR_VERSION.$MUSHCORE_MINOR_VERSION.$MUSHCORE_MICRO_VERSION
MUSHCORE_UNDERSCORE_VERSION=${MUSHCORE_MAJOR_VERSION}_${MUSHCORE_MINOR_VERSION}_${MUSHCORE_MICRO_VERSION}

AC_SUBST(MUSHCORE_MAJOR_VERSION)
AC_SUBST(MUSHCORE_MINOR_VERSION)
AC_SUBST(MUSHCORE_MICRO_VERSION)
AC_SUBST(MUSHCORE_VERSION)
AC_SUBST(MUSHCORE_UNDERSCORE_VERSION)

AM_INIT_AUTOMAKE(mushcore,$MUSHCORE_VERSION)
TOP_SUBDIRS="src"
AC_SUBST(TOP_SUBDIRS)
EXTRA_DIST=""
AC_SUBST(EXTRA_DIST)
AM_CONFIG_HEADER(config.h)

dnl Checks for programs.
AC_PROG_MAKE_SET
AC_PROG_CXX
AC_PROG_INSTALL
AC_PROG_LN_S
AC_DISABLE_SHARED
AC_PROG_LIBTOOL

AC_LANG(C++)

LDFLAGS="$LDFLAGS"
        
dnl Check for libraries
dnl AC_CHECK_LIB(PCRE, main,, AC_CHECK_LIB(pcre, main,, AC_MSG_ERROR([PCRE library not found - home is ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/])))
dnl AC_CHECK_LIB(expat, main,, AC_MSG_ERROR([expat library not found - home is http://expat.sourceforge.net/]))

dnl Checks for header files

AC_CHECK_HEADERS(sstream,,[
AC_MSG_WARN([sstream not found.  Using copy from distribution])
CPPFLAGS="$CPPFLAGS -I\${srcdir}/Support/gcc-2.95.2"
])

AC_CHECK_HEADERS(valarray,,[
AC_MSG_WARN([valarray not found.  Will fall back to vector])
])

AC_CHECK_HEADERS(pcre.h,, [AC_CHECK_HEADERS(pcre/pcre.h,, AC_MSG_ERROR([Cannot find pcre.h header.  Build requires PCRE library - home is ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/]))])
AC_CHECK_HEADERS(expat.h,, [AC_CHECK_HEADERS(expat/expat.h,, AC_MSG_ERROR([Cannot find expat.h header.  Build requires expat library - home is http://expat.sourceforge.net/]))])

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_BIGENDIAN

dnl Check that autogenerated Makefile.ams are there
AC_CHECK_FILE(src,[
AC_CHECK_FILE(src/Makefile.am,,[
AC_MSG_ERROR([src/Makefile.am not present.  Please run autogen.sh])
])
])

AC_OUTPUT(Makefile src/Makefile)
AC_MSG_NOTICE([Verdict was:])
AC_MSG_NOTICE([CPPFLAGS=$CPPFLAGS])
AC_MSG_NOTICE([LDFLAGS=$LDFLAGS])
AC_MSG_NOTICE([LIBS=$LIBS])
